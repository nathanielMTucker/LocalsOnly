{"version":3,"sources":["Components/Picture.jsx","Components/ImageForm.jsx","Pages/EditProfile.jsx"],"names":["Picture","id","publicId","ImageProfileForm","withUser","user","setImage","image","DisplaySelectedImages","images","setImages","className","title","onClick","e","src","URL","createObjectURL","alt","type","name","onChange","preventDefault","files","target","console","dir","avatar","cloudName","secure","upload_preset","preset","ImageForm","folder","multiple","callback","useState","uploading","setUploading","uploadImages","a","log","form","FormData","imageURLs","map","append","fetch","method","body","then","res","json","file","public_id","Promise","all","awaitURLs","removeImage","persist","index","Number","filter","onSubmit","currentImages","EditProfile","withFirebase","history","firebase","localTo","split","state","city","handleBeingChecked","setHandleBeingChecked","handleIsAvailable","setHandleIsAvailable","useToggle","passwordVisible","togglePasswordVisible","undefined","getCookie","updatingLocal","email","handler","charAt","toUpperCase","slice","oldPassword","newPassword","profile","setProfile","checkHandler","useCallback","includes","length","axios","get","catch","err","useEffect","updateProfile","updateEmail","_","patch","ownerID","handle","credentials","emailCredentials","reauth","updatePassword","toLowerCase","replace","setCookie","d","Date","setTime","getTime","expires","toUTCString","exp","getDate","alert","push","HandleCheckIcon","value","LocalUpdateOn","update","today","difT","Math","abs","difD","ceil","isNaN","htmlFor","required","minLength","autoComplete","disabled","maxLength","to"],"mappings":"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","file":"static/js/11.79154c69.chunk.js","sourcesContent":["import React from 'react'\nimport {Image} from 'cloudinary-react';\n\nconst Picture = ({id}) => {\n    \n    return (\n        <Image publicId={id}></Image>\n    )\n}\n\nexport default Picture;","import React, { useState } from \"react\";\nimport Picture from '../Components/Picture';\nimport { CloudinaryContext} from 'cloudinary-react'\nimport {withUser} from \"../User\";\n\nconst ImageForm = ({folder, multiple, callback}) => {\n  const [uploading, setUploading] = useState(false);\n  const [images, setImages] = useState([]);\n\n  const getImagesFromUser = e => {\n    e.preventDefault();\n    const {\n      target: { files },\n    } = e;\n    if(multiple){\n      setImages(currentImages=>[...currentImages, ...files]);\n      return;\n    }\n    setImages([...files]);\n  };\n\n  const uploadImages = async e => {\n    e.preventDefault();\n    console.log(images);\n    \n    const form = new FormData();\n    \n    setUploading(true);\n\n    const imageURLs = images.map(async image=>{\n      form.append('file', image);\n      form.append('upload_preset', `${folder}_images`);\n      \n      return await fetch(`https://api.cloudinary.com/v1_1/dpjlvg7ql/image/upload`, {\n        method:\"POST\",\n        body:form\n      }).then(res=>res.json())\n      .then(file=>{\n        const id = file.public_id\n        console.log(id);\n        return id;\n      })\n    })\n    const awaitURLs = await Promise.all(imageURLs)\n    callback(awaitURLs)\n    \n    setUploading(false);\n  };\n\n  const closeForm = e => {\n    e.preventDefault();\n    setImages([]);\n  };\n\n  \n\n  const DisplaySelectedImages = ({images, setImages}) =>{\n    const removeImage = e =>{\n      e.persist();\n      const index = Number(e.target.id);\n      console.log(\"Image name: \" + index);\n      const {name} = images[index];\n      setImages(images.filter(image=>image.name !== name))\n  }\n  \n    return <div className=\"tile is-ancestor\">\n        <div className=\"tile is-parent image-row\">\n            {images && images.map((image, index)=>(\n                <div className=\"tile is-child image-item\" key={index}>\n                  <span className=\"is-small button is-inverted is-danger delete-image\" title=\"Remove\" id={index} onClick={removeImage}>\n                    <i className=\"far fa-trash-alt\"/>\n                  </span>\n                  <img src={URL.createObjectURL(image)} alt=\"Could not load\"/>\n                </div>\n            ))}\n        </div>\n    </div>\n}\n\n  return (\n    <form onSubmit={uploadImages} className=\"form-container\">\n      <div className=\"file is-centered is-boxed has-name\">\n        <label className=\"file-label\">\n          <input className=\"file-input\" multiple={multiple} type=\"file\" name=\"images\" onChange={getImagesFromUser}/>\n          <span className=\"file-cta\">\n            <span className=\"file-icon\">\n              <i className=\"fas fa-images\"/>\n            </span>\n            <span className=\"file-label\">\n              Get images\n            </span>\n          </span>\n        </label>\n      </div>\n      <div className=\"buttons is-centered section\">\n        <button type=\"submit\" className=\"button is-success\">\n          Upload\n        </button>\n        <button type=\"submit\" className=\"button is-danger\" onClick={closeForm}>\n          Remove all\n        </button>\n      </div>\n      {uploading ? <div>Loading...</div> : <DisplaySelectedImages images={images} setImages={setImages}/>}\n    </form>\n  );\n};\n\nconst ImageProfileForm = withUser(({user, setImage, image})=>{\n\n  const getImagesFromUser = e => {\n    e.preventDefault();\n    const {\n      target: { files },\n    } = e;\n    console.dir(files[0])\n    setImage(files[0]);\n  };\n\n  const DisplaySelectedImages = ({images, setImages}) =>{\n    const removeImage = e =>{\n      setImage(null)\n  }\n  \n    return  (\n    <div className=\"tile is-child image-item\">\n      <span className=\"is-small button is-inverted is-danger delete-image\" title=\"Remove\" onClick={removeImage}>\n        <i className=\"far fa-trash-alt\"/>\n      </span>\n      <img src={URL.createObjectURL(image)} alt=\"Could not load\"/>\n    </div>\n    )\n    \n}\n\n  return (\n    \n      <div>\n          <div className=\"file is-centered is-boxed has-name\">\n            <label className=\"file-label\">\n              <input className=\"file-input\" src={\"./LocalsOnly.png\"} type=\"file\" name=\"images\" onChange={getImagesFromUser}/>\n              <span className=\"image is-128x128\">\n              { \n                user.avatar === null ? <img src=\"https://bulma.io/images/placeholders/128x128.png\" alt=\"User\"/>:\n                    <CloudinaryContext cloudName={\"dpjlvg7ql\"} secure={false} upload_preset=\"avatar_images\">\n                        <Picture id={user.avatar} preset=\"avatar_images\"/>\n                    </CloudinaryContext>\n              }\n              </span>\n            </label>\n          </div>\n          {image && <DisplaySelectedImages/>}\n      </div>\n      \n   \n  );\n})\n\nexport default ImageForm;\n\nexport {\n  ImageProfileForm\n}","import React, {useState, useEffect, useCallback} from 'react';\nimport {ImageProfileForm} from '../Components/ImageForm';\nimport axios from 'axios';\nimport { withUser } from '../User'\nimport { withFirebase } from '../Authentication';\nimport {Link} from 'react-router-dom';\nimport useToggle from \"../Components/useHooks/useToggle\"\nimport { getCookie, setCookie } from '../globals';\n\nconst EditProfile = withFirebase(withUser(({history, firebase, user})=>{\n  let [state, city] = user.localTo.split(':');\n\n  const [handleBeingChecked, setHandleBeingChecked] = useState(false);\n  const [handleIsAvailable, setHandleIsAvailable] = useState(true);\n\n  const [passwordVisible, togglePasswordVisible] = useToggle(false);\n  const [updatingLocal, setUpdatingLocal] = useState(getCookie(\"local-update\") !== undefined)\n  const [image, setImage] = useState(null);\n\n  const [profile, setProfile] = useState({\n    name: user.name || \"\",\n    email: user.email || \"\",\n    handler: user.handler || \"\",\n    city: city.charAt(0).toUpperCase() + city.slice(1) || \"\",\n    state: state.toUpperCase() || \"\",\n    oldPassword: \"\",\n    newPassword: \"\",\n  })\n\n  const checkHandler = useCallback(\n    async ()=>{\n      setHandleBeingChecked(true);\n      // console.log(\"handler has been checked\");\n      if(profile.handler.includes(\" \")|| profile.handler === \"\" || profile.handler.length < 4){\n        return setHandleIsAvailable(false);\n      }\n      if(profile.handler === user.handler){\n        return setHandleIsAvailable(true);\n      }\n      // console.log(profile.handler);\n      await axios.get(`/api/v1/users/handles/${profile.handler}`)\n      .then(res=>{\n        console.dir(res);\n        return setHandleIsAvailable(true);\n      })\n      .catch(err=>{\n        console.log(\"In Handle Check: \" + err);\n        return setHandleIsAvailable(false);\n      })\n      \n    }\n  ,[profile.handler, user.handler])\n\n    \n  useEffect(()=>{\n    \n    if(profile.handler !== user.handler){ \n       checkHandler().then(()=>setHandleBeingChecked(false))\n    }\n    \n  }, [checkHandler, profile.handler, user.handler])\n\n  const uploadImages = async () => {\n    // e.preventDefault();\n    console.log(image);\n    \n    const form = new FormData();\n\n    const imageURLs = async () =>{\n      form.append('file', image);\n      form.append('upload_preset', `avatar_images`);\n      \n      return await fetch(`https://api.cloudinary.com/v1_1/dpjlvg7ql/image/upload`, {\n        method:\"POST\",\n        body:form\n      }).then(res=>res.json())\n      .then(file=>{\n        const id = file.public_id\n        console.log(id);\n        return id;\n      })\n    }\n    return await Promise.all(imageURLs)\n  };\n  \n\n  const updateProfile = async (e) =>{\n    e.preventDefault();\n\n    if(user.email !== profile.email){\n      await firebase.updateEmail(profile.email)\n      .then(async _ =>{\n        console.log(\"Email updated\");\n        await axios.patch(`/api/v1/users/${user.ownerID}/email`,{\n          email:profile.email\n        })\n      })\n      .catch(err=>{\n        console.log(\"Error updating email from edit user page\");\n        console.dir(err)\n      })\n      \n    }\n\n    if(user.name !== profile.name){\n      await axios.patch(`/api/v1/users/${user.ownerID}/name`,{\n        name:profile.name\n      })\n    }\n\n    if(user.handler !== profile.handler){\n      await axios.patch(`/api/v1/users/${user.ownerID}/handle`,{\n        handle:profile.handler\n      })\n    }\n\n    if(profile.newPassword.length >= 6 && profile.newPassword !== profile.oldPassword ){\n      console.log(\"Changing password\");\n      const credentials = firebase.emailCredentials(profile.email, profile.oldPassword);\n      await firebase.reauth(credentials)\n      .then(res=>{\n        // console.dir(res);\n        console.log(\"Re-authenticated\");\n        firebase.updatePassword(profile.newPassword)\n        .then(res=>{\n          console.log(\"New password set\");\n        })\n        .catch(err=>{\n          console.log(\"Error setting new password: \" + err);\n        })\n      })\n      .catch(console.dir)\n      \n    }\n\n    if(image){\n      const form = new FormData();\n    \n      form.append('file', image);\n      form.append('upload_preset', `avatar_images`);\n      \n      return await fetch(`https://api.cloudinary.com/v1_1/dpjlvg7ql/image/upload`, {\n        method:\"POST\",\n        body:form\n      }).then(res=>res.json())\n      .then(file=>{\n        const id = file.public_id\n        console.log(id);\n        return id;\n      })\n      .then(async avatar=>{\n        await axios.patch(`/api/v1/users/${user.ownerID}/avatar`,{\n          avatar\n        }).then(res=>{\n          console.dir(\"Updated Avatar: \" + res);\n        })\n      })\n\n      \n    }\n    \n    if(profile.state.toLowerCase() !== state.toLowerCase() || profile.city.toLowerCase() !== city.toLowerCase()){\n      const localTo = profile.state.toLowerCase() + \":\" + profile.city.toLowerCase().replace(\" \", \"-\")\n      setCookie(\"local-update\", localTo, 1000);\n      const d = new Date();\n      d.setTime(d.getTime() + (30*24*60*60*1000));\n      let expires = d.toUTCString();\n      \n      setCookie(\"local-update-on\", expires, 30)\n      const exp = getCookie(\"local-update-on\");\n      // console.log(exp);\n      const a = new Date(exp);\n      console.log(a.getDate());\n    }\n\n    alert(\"Your profile has been updated!\")\n    history.push(\"/dashboard\")\n\n  }\n  const HandleCheckIcon = ()=>{\n    if(handleBeingChecked === true) \n      return <span className=\"icon is-small is-right has-text-info\">\n        <i className=\"fas fa-circle-notch fa-pulse\"/>\n      </span>\n\n    if(handleIsAvailable) \n      return <span className=\"icon is-small is-right has-text-success\">\n        <i className=\"fas fa-check\"/>\n      </span>\n    \n     return <span className=\"icon is-small is-right has-text-danger\">\n        <i className=\"fas fa-times\"/>\n      </span>\n    \n  }\n  const onChange = e =>{\n    e.preventDefault();\n    let {name, value} = e.target;\n    if(name === \"password\") setProfile({...profile, [name]:value.replace(\" \", \"\")})\n    else setProfile({...profile, [name]:value})\n    // console.log(`onChange ${name}: ${value}`)\n  }\n\n  const LocalUpdateOn = ()=>{\n    const update = new Date(getCookie(\"local-update-on\"))\n    const today = new Date()\n    const difT = Math.abs(update - today);\n    let difD = Math.ceil(difT / (1000*60*60*24));\n    // if(difD === NaN)\n    if(difD <= 1 || isNaN(difD)){\n      difD = \"today\"\n    }else{\n      difD = \"in \"+difD + \" days\"\n    }\n    return <span>{difD}</span>\n  }\n\n  const deleteAccount = e =>{\n    e.preventDefault();\n  }\n\n  return <main id=\"avatar-upload-page\" className=\"section mt-4 container\">\n    <div className=\"columns is-centered\">\n    <h1 className=\"title column has-text-centered my-3\">Edit Profile</h1>\n    </div>\n        <form onSubmit={updateProfile} className=\"\">\n    <section className=\"section container box columns\">\n    <div className=\"column\">\n        <ImageProfileForm setImage={setImage} image={image}/>\n      </div>\n      <div className=\"column\">\n\n          <div className=\"field\">\n            <label htmlFor=\"name\">Name</label>\n            <div className=\"control has-icons-left\">\n              <input type=\"text\" name=\"name\" value={profile.name} className=\"input\" onChange={onChange} required/>\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-user\"/>\n              </span>\n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label htmlFor=\"handler\">Handler</label>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input type=\"text\" name=\"handler\" value={profile.handler} className=\"input\" onChange={onChange} minLength={4} required/>\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-at\"/>\n              </span>\n              <HandleCheckIcon/>\n              \n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label htmlFor=\"email\">Email</label>\n            <div className=\"control has-icons-left\">\n              <input type=\"text\" name=\"email\" value={profile.email} className=\"input\" onChange={onChange} required/>\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-envelope\"/>\n              </span>\n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label htmlFor=\"email\">Old Password</label>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input type={passwordVisible ? \"text\" : \"password\"} name=\"oldPassword\" value={profile.oldPassword} className=\"input\" onChange={onChange}/>\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-key\"/>\n              </span>\n              <span className=\"icon password-visible-icon is-small is-right\" onClick={togglePasswordVisible}>\n                {\n                  !passwordVisible ? <i className=\"fas fa-eye-slash\"/> : <i className=\"fas fa-eye\"/>\n                }\n              </span>\n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label htmlFor=\"email\">New Password</label>\n            <div className=\"control has-icons-left has-icons-right\">\n              <input type={passwordVisible ? \"text\" : \"password\"} autoComplete=\"new-password\" name=\"newPassword\" value={profile.newPassword} className=\"input\" onChange={onChange}/>\n              <span className=\"icon is-small is-left\">\n                <i className=\"fas fa-key\"/>\n              </span>\n              <span className=\"icon password-visible-icon is-small is-right\" onClick={togglePasswordVisible}>\n                {\n                  !passwordVisible ? <i className=\"fas fa-eye-slash\"/> : <i className=\"fas fa-eye\"/>\n                }\n              </span>\n            </div>\n          </div>\n\n          <div className=\"field\">\n            <label htmlFor=\"local\">City/Town</label>\n            {updatingLocal && <span className=\"pl-2 has-text-danger\">Your local will update <LocalUpdateOn/></span>}\n            <div name=\"local\" className=\"control\">\n              <input type=\"text\" name=\"city\" value={profile.city} className=\"input\" onChange={onChange} required disabled={updatingLocal}/>\n            </div>\n            <label htmlFor=\"local\">State</label>\n              <div className=\"control\">\n              <input type=\"text\" name=\"state\" value={profile.state} className=\"input\" onChange={onChange} required minLength={2} maxLength={2} disabled={updatingLocal}/>\n              </div>\n          </div>\n          <div className=\"level\">\n            <div className=\"level-left buttons \"><button className=\"button is-success\" disabled={!handleIsAvailable}>Submit</button>\n            <Link className=\"button is-danger\" to=\"/dashboard\">Cancel</Link></div>\n          {/* <div className=\"level-right\"><button className=\"button is-danger is-inverted\" onClick={deleteAccount}>Delete Account</button></div> */}\n          </div>\n      </div>\n    </section>\n        </form>\n  </main>\n}))\n\nexport default EditProfile;"],"sourceRoot":""}