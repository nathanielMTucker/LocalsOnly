{"ast":null,"code":"'use strict';\n\nvar BPromise = require('bluebird');\n/**\n* Constructor\n* @param <object> geocoder  Geocoder Adapter\n* @param <object> formatter Formatter adapter or null\n*/\n\n\nvar Geocoder = function (geocoder, formatter) {\n  this._geocoder = geocoder;\n  this._formatter = formatter;\n};\n/**\n* Geocode a value (address or ip)\n* @param <string>   value    Value to geocoder (address or IP)\n* @param <function> callback Callback method\n*/\n\n\nGeocoder.prototype.geocode = function (value, callback) {\n  return BPromise.resolve().bind(this).then(function () {\n    return BPromise.fromCallback(function (callback) {\n      this._geocoder.geocode(value, callback);\n    }.bind(this));\n  }).then(function (data) {\n    return this._filter(value, data);\n  }).then(function (data) {\n    return this._format(data);\n  }).asCallback(callback);\n};\n/**\n* Reverse geocoding\n* @param {lat:<number>,lon:<number>}  lat: Latitude, lon: Longitude\n* @param {function} callback Callback method\n*/\n\n\nGeocoder.prototype.reverse = function (query, callback) {\n  return BPromise.resolve().bind(this).then(function () {\n    return BPromise.fromCallback(function (callback) {\n      this._geocoder.reverse(query, callback);\n    }.bind(this));\n  }).then(function (data) {\n    return this._format(data);\n  }).asCallback(callback);\n};\n/**\n* Batch geocode\n* @param <array>    values    array of Values to geocode (address or IP)\n* @param <function> callback\n*\n* @return promise\n*/\n\n\nGeocoder.prototype.batchGeocode = function (values, callback) {\n  return BPromise.resolve(values).bind(this).map(function (value) {\n    return this.geocode(value).then(function (value) {\n      return {\n        error: null,\n        value: value\n      };\n    }).catch(function (error) {\n      return {\n        error: error,\n        value: null\n      };\n    });\n  }).asCallback(callback);\n};\n\nGeocoder.prototype._filter = function (value, data) {\n  if (!data || !data.length) {\n    return data;\n  }\n\n  if (value.minConfidence) {\n    data = data.filter(function (geocodedAddress) {\n      if (geocodedAddress.extra && geocodedAddress.extra.confidence) {\n        return geocodedAddress.extra.confidence >= value.minConfidence;\n      }\n    });\n  }\n\n  return data;\n};\n\nGeocoder.prototype._format = function (data) {\n  var _this = this;\n\n  return BPromise.resolve().bind(this).then(function () {\n    if (!data) {\n      return data;\n    }\n\n    var _raw = data.raw;\n    data = data.map(function (result) {\n      result.provider = _this._geocoder.name;\n      return result;\n    });\n    data.raw = _raw;\n    Object.defineProperty(data, 'raw', {\n      configurable: false,\n      enumerable: false,\n      writable: false\n    });\n    return data;\n  }).then(function (data) {\n    var _data = data;\n\n    if (this._formatter && this._formatter !== 'undefined') {\n      _data = this._formatter.format(_data);\n    }\n\n    return _data;\n  });\n};\n\nmodule.exports = Geocoder;","map":{"version":3,"sources":["C:/Users/nmtuc/Desktop/Dev/web/localsonly/frontend/node_modules/node-geocoder/lib/geocoder.js"],"names":["BPromise","require","Geocoder","geocoder","formatter","_geocoder","_formatter","prototype","geocode","value","callback","resolve","bind","then","fromCallback","data","_filter","_format","asCallback","reverse","query","batchGeocode","values","map","error","catch","length","minConfidence","filter","geocodedAddress","extra","confidence","_this","_raw","raw","result","provider","name","Object","defineProperty","configurable","enumerable","writable","_data","format","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar BPromise = require('bluebird');\n\n/**\n* Constructor\n* @param <object> geocoder  Geocoder Adapter\n* @param <object> formatter Formatter adapter or null\n*/\nvar Geocoder = function (geocoder, formatter) {\n  this._geocoder = geocoder;\n  this._formatter = formatter;\n};\n\n/**\n* Geocode a value (address or ip)\n* @param <string>   value    Value to geocoder (address or IP)\n* @param <function> callback Callback method\n*/\nGeocoder.prototype.geocode = function (value, callback) {\n  return BPromise.resolve()\n    .bind(this)\n    .then(function() {\n      return BPromise.fromCallback(function(callback) {\n        this._geocoder.geocode(value, callback);\n      }.bind(this));\n    })\n    .then(function(data) {\n      return this._filter(value, data);\n    })\n    .then(function(data) {\n      return this._format(data);\n    })\n    .asCallback(callback);\n};\n\n/**\n* Reverse geocoding\n* @param {lat:<number>,lon:<number>}  lat: Latitude, lon: Longitude\n* @param {function} callback Callback method\n*/\nGeocoder.prototype.reverse = function(query, callback) {\n  return BPromise.resolve()\n    .bind(this)\n    .then(function() {\n      return BPromise.fromCallback(function(callback) {\n        this._geocoder.reverse(query, callback);\n      }.bind(this));\n    })\n    .then(function(data) {\n      return this._format(data);\n    })\n    .asCallback(callback);\n};\n\n/**\n* Batch geocode\n* @param <array>    values    array of Values to geocode (address or IP)\n* @param <function> callback\n*\n* @return promise\n*/\nGeocoder.prototype.batchGeocode = function(values, callback) {\n  return BPromise.resolve(values)\n    .bind(this)\n    .map(function(value) {\n      return this.geocode(value)\n        .then(function(value) {\n          return {\n            error: null,\n            value: value\n          };\n        })\n        .catch(function(error) {\n          return {\n            error: error,\n            value: null\n          };\n        });\n    })\n    .asCallback(callback);\n};\n\nGeocoder.prototype._filter = function (value, data) {\n  if (!data || !data.length) {\n    return data;\n  }\n\n  if (value.minConfidence) {\n    data = data.filter(function(geocodedAddress) {\n      if (geocodedAddress.extra && geocodedAddress.extra.confidence) {\n        return geocodedAddress.extra.confidence >= value.minConfidence;\n      }\n    });\n  }\n\n  return data;\n};\n\nGeocoder.prototype._format = function (data) {\n  var _this = this;\n  return BPromise.resolve()\n    .bind(this)\n    .then(function() {\n      if (!data) {\n        return data;\n      }\n\n      var _raw = data.raw;\n\n      data = data.map(function(result) {\n        result.provider = _this._geocoder.name;\n\n        return result;\n      });\n\n      data.raw = _raw;\n      Object.defineProperty(data,'raw',{configurable:false, enumerable:false, writable:false});\n\n      return data;\n    })\n    .then(function(data) {\n      var _data = data;\n      if (this._formatter && this._formatter !== 'undefined') {\n        _data = this._formatter.format(_data);\n      }\n\n      return _data;\n    });\n};\n\nmodule.exports = Geocoder;\n"]},"metadata":{},"sourceType":"script"}